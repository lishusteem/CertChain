<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CertID Wallet - Settings</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .back-button {
            font-size: 24px;
            cursor: pointer;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="status-bar">
            <span class="time" id="current-time">9:41</span>
            <div class="icons">
                <span>üì∂</span>
                <span>üì°</span>
                <span>üîã</span>
            </div>
        </div>
        
        <div class="header">
            <div style="display: flex; align-items: center;">
                <span class="back-button" id="back-to-wallet">‚Üê</span>
                <h1>SetƒÉri</h1>
            </div>
        </div>
        
        <div class="wallet-card">
            <div class="label">Identitate Blockchain</div>
            <div class="wallet-address" id="wallet-address">√éncƒÉrcare...</div>
            <div class="label" style="margin-top: 10px;">Re»õea</div>
            <div id="network-info" style="font-size: 14px; font-weight: 500;">Sepolia Testnet</div>
        </div>
        
        <div class="wallet-actions" style="margin-top: 20px;">
            <button class="action-button" id="backup-wallet-button">
                <span class="icon">üîí</span>
                <span>Backup Portofel</span>
            </button>
            <button class="action-button" id="restore-wallet-button">
                <span class="icon">üîÑ</span>
                <span>Reini»õializeazƒÉ o cheie privatƒÉ</span>
            </button>
            <button class="action-button" id="new-wallet-button">
                <span class="icon">üîë</span>
                <span>GenereazƒÉ o cheie privatƒÉ nouƒÉ</span>
            </button>
        </div>
        
        <div class="info-card" style="margin: 20px;">
            <div class="info-title">Informa»õii Portofel</div>
            <div class="info-text">
                Fii atent c√¢nd efectuezi opera»õiuni pe portofelul tƒÉu. AsigurƒÉ-te cƒÉ ai un backup sigur al cuvintelor mnemonice pentru a-»õi recupera portofelul √Æn caz de nevoie.
            </div>
        </div>
    </div>
    
    <!-- Backup Wallet Modal -->
    <div class="modal" id="backup-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Backup Portofel</div>
                <button class="close-button" id="close-backup-modal">&times;</button>
            </div>
            <div class="info-text" style="margin-bottom: 15px;">
                <strong>IMPORTANT:</strong> NoteazƒÉ-»õi aceste cuvinte √Æntr-un loc sigur. Ele sunt singura modalitate de a-»õi recupera portofelul dacƒÉ pierzi accesul la acest dispozitiv.
            </div>
            <div style="background-color: var(--background-alt); padding: 15px; border-radius: var(--radius); margin-bottom: 15px; word-spacing: 5px; font-family: monospace; text-align: center; font-weight: 500;" id="mnemonic-phrase">
                √éncƒÉrcare cuvinte mnemonice...
            </div>
            <div class="info-text" style="margin-bottom: 15px; color: var(--danger);">
                Nu partaja niciodatƒÉ aceste cuvinte cu nimeni! Oricine are acces la aceste cuvinte va avea control complet asupra portofelului tƒÉu.
            </div>
            <button class="sign-button" id="copy-mnemonic" style="width: 100%;">CopiazƒÉ cuvintele</button>
        </div>
    </div>
    
    <!-- Restore Wallet Modal -->
    <div class="modal" id="restore-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">RestaureazƒÉ Portofel</div>
                <button class="close-button" id="close-restore-modal">&times;</button>
            </div>
            <div class="info-text" style="margin-bottom: 15px;">
                Introdu cele 12 cuvinte mnemonice pentru a-»õi restaura portofelul.
            </div>
            <textarea style="width: 100%; height: 100px; padding: 10px; border-radius: var(--radius); border: 1px solid var(--border); margin-bottom: 15px; font-family: monospace;" id="restore-phrase" placeholder="Introdu cuvintele mnemonice separate prin spa»õii..."></textarea>
            <div class="info-text" style="margin-bottom: 15px; color: var(--warning);">
                <strong>Aten»õie:</strong> AceastƒÉ ac»õiune va √Ænlocui portofelul curent. AsigurƒÉ-te cƒÉ ai fƒÉcut backup √Ænainte de a continua.
            </div>
            <button class="sign-button" id="restore-wallet" style="width: 100%;">RestaureazƒÉ Portofelul</button>
        </div>
    </div>

    <!-- Hidden elements needed for JavaScript compatibility -->
    <div style="display:none;">
        <div id="wallet-creation-modal"></div>
        <div id="backup-acknowledge-modal"></div>
        <div id="confirmation-modal"></div>
        <div id="qr-modal"></div>
    </div>
    
    <!-- Toast Messages -->
    <div class="toast" id="toast-message"></div>
    
    <!-- Include Scripts -->
    <script>
        // Flag to track if ethers.js loaded successfully
        window.ethersLoaded = false;
        
        // Function to notify that ethers loaded
        function ethersLoadSuccess() {
            window.ethersLoaded = true;
            console.log("ethers.js loaded successfully");
        }
        
        // Function to try loading from another CDN if the first one fails
        function loadFallbackEthers() {
            if (!window.ethersLoaded) {
                console.log("Trying fallback CDN for ethers.js");
                const script = document.createElement('script');
                script.src = "https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js";
                script.onload = ethersLoadSuccess;
                document.body.appendChild(script);
            }
        }
    </script>
    
    <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js" 
        onload="ethersLoadSuccess()" 
        onerror="loadFallbackEthers()"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js" type="application/javascript"></script>
    <script src="script.js"></script>
    
    <script>
        // Navigation script for multi-page functionality
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Settings page DOM loaded");
            
            // Redirect to index.html if no wallet exists
            setTimeout(function() {
                if (!localStorage.getItem('certid-wallet')) {
                    window.location.href = "index.html";
                }
            }, 600);
            
            // Back button navigation
            document.getElementById('back-to-wallet').addEventListener('click', function() {
                window.location.href = "wallet.html";
            });
            
            // Override showInitialScreen to redirect to index.html
            window.showInitialScreen = function() {
                window.location.href = "index.html";
            };
            
            // Make sure backup wallet button works
            if (document.getElementById('backup-wallet-button')) {
                document.getElementById('backup-wallet-button').addEventListener('click', function() {
                    console.log("Backup wallet button clicked");
                    // Get mnemonic
                    const mnemonic = localStorage.getItem('certid-wallet-mnemonic');
                    
                    if (mnemonic) {
                        // Show mnemonic in modal
                        document.getElementById('mnemonic-phrase').textContent = mnemonic;
                        document.getElementById('backup-modal').style.display = 'flex';
                    } else {
                        showToast('Nu s-au putut gƒÉsi cuvintele de recuperare', 'error');
                    }
                });
            }
            
            // Make sure restore wallet button works
            if (document.getElementById('restore-wallet-button')) {
                document.getElementById('restore-wallet-button').addEventListener('click', function() {
                    console.log("Restore wallet button clicked");
                    document.getElementById('restore-modal').style.display = 'flex';
                });
            }
            
            // New wallet button
            document.getElementById('new-wallet-button').addEventListener('click', function() {
                console.log("New wallet button clicked");
                if (confirm('E»ôti sigur cƒÉ dore»ôti sƒÉ generezi o cheie privatƒÉ nouƒÉ? Acest lucru va √Ænlocui portofelul curent.')) {
                    localStorage.removeItem('certid-wallet');
                    localStorage.removeItem('certid-wallet-mnemonic');
                    window.location.href = "index.html";
                }
            });
            
            // Make sure modal close buttons work
            document.getElementById('close-backup-modal').addEventListener('click', function() {
                document.getElementById('backup-modal').style.display = 'none';
            });
            
            document.getElementById('close-restore-modal').addEventListener('click', function() {
                document.getElementById('restore-modal').style.display = 'none';
            });
            
            // Copy mnemonic button
            document.getElementById('copy-mnemonic').addEventListener('click', function() {
                const mnemonic = document.getElementById('mnemonic-phrase').textContent;
                navigator.clipboard.writeText(mnemonic).then(() => {
                    showToast('Cuvinte copiate √Æn clipboard');
                });
            });
            
            // Update network info
            setTimeout(function() {
                if (window.NETWORK_CONFIG && window.NETWORK_CONFIG.name) {
                    document.getElementById('network-info').textContent = window.NETWORK_CONFIG.name + " Testnet";
                }
            }, 1000);
        });
    </script>
</body>
</html>
